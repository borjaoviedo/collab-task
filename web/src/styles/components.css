@layer components {
  /* ----- Buttons ----- */
  .btn {
    @apply inline-flex items-center justify-center gap-2 font-medium
           rounded-[var(--radius)] px-4 py-2 transition-colors
           focus:outline-none focus-visible:ring-4 focus-visible:ring-[color:var(--color-ring)]
           disabled:opacity-50 disabled:pointer-events-none border border-transparent
           select-none;
  }

  /* Solid variants */
  .btn-primary   { color: var(--color-primary-foreground);   background: var(--color-primary); }
  .btn-secondary { color: var(--color-secondary-foreground); background: var(--color-secondary); }
  .btn-success   { color: var(--color-success-foreground);   background: var(--color-success); }
  .btn-warning   { color: var(--color-warning-foreground);   background: var(--color-warning); }
  .btn-danger    { color: var(--color-destructive-foreground); background: var(--color-destructive); }

  .btn-primary:hover,
  .btn-secondary:hover,
  .btn-success:hover,
  .btn-warning:hover,
  .btn-danger:hover {
    filter: brightness(0.95);
  }

  /* Outline variant */
  .btn-outline {
    @apply bg-transparent border;
    color: var(--color-foreground);
    border-color: color-mix(in oklch, var(--color-foreground) 30%, transparent);
  }
  .btn-outline:hover {
    background: color-mix(in oklch, var(--color-muted) 55%, transparent);
  }

  /* Sizes */
  .btn-sm { @apply h-9  px-3 text-sm; }
  .btn-md { @apply h-10 px-4 text-sm; }
  .btn-lg { @apply h-12 px-6 text-base; }

  /* Elevation */
  .btn-elev-0 { box-shadow: var(--shadow-sm); }
  .btn-elev-1 { box-shadow: var(--shadow); }
  .btn-elev-2 { box-shadow: var(--shadow-lg); }

  /* Loading spinner */
  .btn .spinner {
    @apply inline-block align-[-0.125em];
    width: 1rem; height: 1rem;
    border-radius: 9999px;
    border: 2px solid currentColor;
    border-right-color: transparent;
    animation: spin 0.8s linear infinite;
  }

  /* ----- Labels ----- */
  .label { @apply block font-medium select-none text-[color:var(--color-foreground)]; }
  .label-sm { @apply text-xs; }
  .label-md { @apply text-sm; }
  .label-required { @apply text-[color:var(--color-destructive)] ml-1; }

  /* ----- Inputs ----- */
  .input {
    @apply w-full rounded-[var(--radius)]
           bg-[color:var(--color-input)] text-[color:var(--color-foreground)]
           placeholder-[color:var(--color-muted-foreground)]
           border border-[color:var(--color-border)]
           px-3 transition-shadow
           focus:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-ring)]
           disabled:opacity-50 disabled:cursor-not-allowed;
    height: 2.5rem;
  }
  .input-sm { @apply h-9 text-sm px-3; }
  .input-md { @apply h-10 text-sm px-3; }
  .input-lg { @apply h-12 text-base px-4; }

  .input-invalid {
    border-color: var(--color-destructive);
    box-shadow: 0 0 0 2px color-mix(in oklch, var(--color-destructive) 40%, transparent);
  }

  /* ----- FormErrorText ----- */
  .form-error { @apply text-sm mt-1; color: var(--color-destructive); }

  /* ----- Card ----- */
  .card {
    background: transparent;
    border: none;
    box-shadow: none;
    @apply rounded-2xl text-[color:var(--color-card-foreground)];
  }
  .card-title { @apply px-5 pt-5 text-lg font-semibold; }
  .card-body  { @apply p-5; }

  /* ----- Theme Controls ----- */
  .theme-controls {
    @apply flex items-center flex-wrap gap-3;
  }

  /* Light/Dark segmented container */
  .mode-segment {
    display: inline-flex;
    gap: 4px;
    padding: 2px;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-full);
    background: var(--color-background);
    box-shadow: var(--shadow-sm);
  }

  .mode-segment .btn {
    height: 1.75rem;
    line-height: 1;
    padding-inline: .75rem;
    border: 0;
    border-radius: var(--radius-full);
    background: transparent;
    transition: transform .12s ease, box-shadow .12s ease, outline-color .12s ease;
  }

  /* Hover */
  .mode-segment .btn:hover {
    box-shadow: var(--shadow);
  }

  /* If no active button, allow ring on hover */
  .mode-segment:not(:has(.btn[data-active="true"])) .btn:hover {
    outline: 2px solid var(--color-ring);
    outline-offset: 2px;
  }

  /* If an active button exists, suppress ring on the other when hovered */
  .mode-segment:has(.btn[data-active="true"]) .btn:hover:not([data-active="true"]) {
    outline: none;
    background: var(--color-muted); /* subtle highlight without ring */
    border-color: var(--color-border);
  }

  /* Active: strong elevation + ring */
  .mode-segment .btn[data-active="true"] {
    background: var(--color-muted);
    box-shadow: var(--shadow-lg);
    outline: 2px solid var(--color-ring);
    outline-offset: 2px;
  }

  /* Accessibility: always show ring on keyboard focus */
  .mode-segment .btn:focus-visible {
    outline: 2px solid var(--color-ring);
    outline-offset: 2px;
  }

  /* Fallback for browsers without :has (put hovered element on top) */
  @supports not (selector(:has(*))) {
    .mode-segment .btn:hover { z-index: 1; }
  }

  /* ----- Theme Options (swatches) ----- */
  .theme-option {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.75rem;
    height: 1.75rem;
    border-radius: 9999px;
    border: 1px solid var(--color-border);
    box-shadow: var(--shadow-sm);
    cursor: pointer;
    transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease, outline-color .12s ease;
  }

  .theme-option-neutral { background: var(--neutral-base); }
  .theme-option-warm    { background: var(--warm-base); }
  .theme-option-cool    { background: var(--cool-base); }

  .theme-option:hover {
    box-shadow: var(--shadow);
    outline: 2px solid var(--color-ring);
    outline-offset: 2px;
  }

  .theme-option:focus-visible {
    outline: 2px solid var(--color-ring);
    outline-offset: 2px;
  }

  .theme-option[data-active="true"] {
    box-shadow: var(--shadow-lg);
    outline: 2px solid var(--color-ring);
    outline-offset: 2px;
    border-color: transparent;
  }
}

@layer utilities {
  @keyframes spin { to { transform: rotate(360deg); } }
  .sr-only {
    position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
    overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0;
  }
}
